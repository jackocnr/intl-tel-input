<script>
  const liveResults = document.querySelector(".iti-live-results");
  const errorMap = ["", "Bad country code", "Too short", "Too long"];

  if (window.iti && liveResults) {
    // fix live results box width and height to prevent layout shift
    const liveResultsStyle = getComputedStyle(liveResults);
    liveResults.style.width = liveResultsStyle.width;
    liveResults.style.height = liveResultsStyle.height;

    const setupLiveResults = () => {
      const itiInput = document.querySelector(".iti__tel-input");
      const emptyMessage = liveResults.textContent;

      const updateResults = () => {
        const hasValue = itiInput.value.trim().length > 0;
        if (hasValue) {
          if (iti.isValidNumber()) {
            const number = iti.getNumber();
            liveResults.textContent = `Valid number: ${number}`;
          } else {
            const errorCode = iti.getValidationError();
            const errorMessage = errorMap[errorCode];
            const errorSuffix = errorMessage ? ` (${errorMessage})` : "";
            liveResults.textContent = `Invalid number${errorSuffix}`;
          }
        } else {
          liveResults.textContent = emptyMessage;
        }
      }
      itiInput.addEventListener("input", updateResults);
      itiInput.addEventListener("countrychange", updateResults);
      updateResults();
    };
    window.iti.promise.then(setupLiveResults);
  }
</script>
